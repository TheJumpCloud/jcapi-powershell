#Requires -Modules powershell-yaml
Param(
    [Parameter(Mandatory = $true, ValueFromPipelineByPropertyName = $true, HelpMessage = 'Name of the API to build an SDK for.')][ValidateSet('V1', 'V2')][ValidateNotNullOrEmpty()][System.String[]]$APIName
)
.($PSScriptRoot + '/Invoke-Git.ps1')
Set-Location $PSScriptRoot
$ApiHash = [Ordered]@{
    # 'Url_V1' = 'https://api.stoplight.io/v1/versions/sNtcAibbBX7Nizrmd/export/oas.yaml'; # StopLight
    # 'Url_V2' = 'https://api.stoplight.io/v1/versions/JWvycPWBDeEZ3R5dF/export/oas.yaml'; # StopLight
    # 'Url_V1' = 'https://api.stoplight.io/v1/versions/MeLBYr6CGg2f4g9Qh/export/oas.json' # Docs
    # 'Url_V2' = 'https://api.stoplight.io/v1/versions/kP6fw2Ppd9ZbbfNmT/export/oas.json' # Docs
    'Url_V1' = 'https://raw.githubusercontent.com/TheJumpCloud/SI/master/routes/webui/api/index.yaml?token=AK5FVUL6WP7Y5LZPNYRMDKS5YA5SU'
    'Url_V2' = 'https://raw.githubusercontent.com/TheJumpCloud/SI/master/routes/webui/api/v2/index.yaml?token=AK5FVUJTT7DXI4VGEQ5VW5S5YA5QY'
}
$UpdatedSpec = $false
$OutputFilePath = $PSScriptRoot + '/SwaggerSpecs/'
# Build Find and Replace table
$FindReplaceHash = [Ordered]@{
    # V1 Issues
    ',"/tags/{name}": {"parameters": [{"name": "name","in": "path","required": true,"type": "string"}],"delete": {"operationId": "tags_delete","summary": "Delete a Tag","tags": ["Tags"],"description": "Hidden as Tags is deprecated\n\nDelete a Tag.","parameters": [{"$ref": "#/parameters/trait:requestHeaders:Content-Type"},{"$ref": "#/parameters/trait:requestHeaders:Accept"}],"responses": {"200": {"description": "","schema": {"$ref": "#/definitions/tag"}}},"security": [{"x-api-key": []}]}}' = '' # Prevents PowerShell from parsing json. Within the "paths" section there is "/tags/{name}" and "/Tags/{name}" which causes a duplication error.
    # V2 Issues
    '"": {"domain": "veniam"}'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                = ''; # Prevents PowerShell from parsing json. # Property name can not be blank.
    # Path Issues
    '"#/definitions/system"'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  = '"#/definitions/JcSystem"'; # The "system" class is a reserved word.
    '"system": {"title": "System"'                                                                                                                                                                                                                                                                                                                                                                                                                                                                            = '"JcSystem": {"title": "System"'; # The "system" class is a reserved word.
    '"system": {"properties": {"_id"'                                                                                                                                                                                                                                                                                                                                                                                                                                                                         = '"JcSystem": {"properties": {"_id"';
    # V1 Issues
    '"basePath": "/api"'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      = '"basePath": "/api/"'; # The extra slash at the end is needed to properly build the url.
    '"type": "object","organization": {"type": "string","description": "The ID of the organization."}'                                                                                                                                                                                                                                                                                                                                                                                                        = '"type":"object"'; # This section is in the wrong place within the json.
    '"command": {"title": "Command", "type": "object", "organization": {"type": "string", "description": "The ID of the organization."},'                                                                                                                                                                                                                                                                                                                                                                     = '"command": {"title": "Command", "type": "object",'
    '"command": {"organization": {"description": "The ID of the organization.", "type": "string"},'                                                                                                                                                                                                                                                                                                                                                                                                           = '"command": {';
    '"type": "null"'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          = '"type": "string"'; # A type of null is not valid.
    '"type": ["null","integer"]'                                                                                                                                                                                                                                                                                                                                                                                                                                                                              = '"type": "integer"'; # A type of null is not valid.
    '"type": ["null", "integer"]'                                                                                                                                                                                                                                                                                                                                                                                                                                                                             = '"type": "integer"'
    # V2 Issues
    '"basePath": "/api/v2"'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   = '"basePath": "/api/v2/"'; # The extra slash at the end is needed to properly build the url.
    '["object","null"]'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       = '"object"'; # A type of null is not valid.
    '["string","null"]'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       = '"string"'; # A type of null is not valid.
    '["string","number","boolean","null"]'                                                                                                                                                                                                                                                                                                                                                                                                                                                                    = '"string"'; # A type of null is not valid.
    '["string","number","boolean"]'                                                                                                                                                                                                                                                                                                                                                                                                                                                                           = '"string"'; # Error: Invalid type 'string,number,boolean' in schema
    '["string", "number", "boolean"]'                                                                                                                                                                                                                                                                                                                                                                                                                                                                         = '"string"';
    '["string", "number", "boolean", "null"]'                                                                                                                                                                                                                                                                                                                                                                                                                                                                 = '"string"';
    '["object", "null"]'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      = '"object"';
    '["string", "null"]'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      = '"string"';
    '["null", "integer"]'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     = '"integer"';
    '"jobId"'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 = '"id"'; # The transform removes the "-" in the parent objects name, "job-id", which makes the parent name the same as the child.
    '"collection_time": ''2019-05-16T12:58:15.6730000-06:00'''                                                                                                                                                                                                                                                                                                                                                                                                                                                = '"collection_time": "2019-05-16T12:58:15.6730000-06:00"';
    '"collection_time": ''2019-06-03T13:41:29.7100000-06:00'''                                                                                                                                                                                                                                                                                                                                                                                                                                                = '"collection_time": "2019-06-03T13:41:29.7100000-06:00"';
    '"collection_time": ''2019-06-03T13:41:30.7710000-06:00'''                                                                                                                                                                                                                                                                                                                                                                                                                                                = '"collection_time": "2019-06-03T13:41:30.7710000-06:00"';
    '"collection_time": ''2019-06-03T13:41:31.5570000-06:00'''                                                                                                                                                                                                                                                                                                                                                                                                                                                = '"collection_time": "2019-06-03T13:41:31.5570000-06:00"';
    '"collection_time": ''2019-06-03T13:41:30.6580000-06:00'''                                                                                                                                                                                                                                                                                                                                                                                                                                                = '"collection_time": "2019-06-03T13:41:30.6580000-06:00"';
    '"collection_time": ''2019-06-03T13:41:30.8580000-06:00'''                                                                                                                                                                                                                                                                                                                                                                                                                                                = '"collection_time": "2019-06-03T13:41:30.8580000-06:00"';
    '"collection_time": ''2019-06-03T13:41:30.9330000-06:00'''                                                                                                                                                                                                                                                                                                                                                                                                                                                = '"collection_time": "2019-06-03T13:41:30.9330000-06:00"';
    '"collection_time": ''2019-06-03T13:41:31.0080000-06:00'''                                                                                                                                                                                                                                                                                                                                                                                                                                                = '"collection_time": "2019-06-03T13:41:31.0080000-06:00"';
    '"collection_time": ''2019-06-03T13:41:31.2040000-06:00'''                                                                                                                                                                                                                                                                                                                                                                                                                                                = '"collection_time": "2019-06-03T13:41:31.2040000-06:00"';
    '"collection_time": ''2019-06-03T13:41:31.1250000-06:00'''                                                                                                                                                                                                                                                                                                                                                                                                                                                = '"collection_time": "2019-06-03T13:41:31.1250000-06:00"';
    '"collection_time": ''2019-06-03T13:41:31.6730000-06:00'''                                                                                                                                                                                                                                                                                                                                                                                                                                                = '"collection_time": "2019-06-03T13:41:31.6730000-06:00"';
    '"collection_time": ''2019-06-03T13:41:31.7460000-06:00'''                                                                                                                                                                                                                                                                                                                                                                                                                                                = '"collection_time": "2019-06-03T13:41:31.7460000-06:00"';
    # Custom Tweaks
    '"tags": ["Systemusers"]'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 = '"tags": ["SystemUsers"]'; # Change casing for pretty cmdlet names
    '{"$ref": "#/parameters/trait:requestHeaders:Content-Type"}'                                                                                                                                                                                                                                                                                                                                                                                                                                              = ''; # This will be passed in later through the Module.cs file.
    '{"$ref": "#/parameters/trait:requestHeaders:Accept"}'                                                                                                                                                                                                                                                                                                                                                                                                                                                    = ''; # This will be passed in later through the Module.cs file.
    '{"$ref": "#/parameters/trait:multiTenantRequestHeaders:x-org-id"}'                                                                                                                                                                                                                                                                                                                                                                                                                                       = ''; # Along with the ApiKey this will be passed in later through the Module.cs file.
    '{"name": "Content-Type","in": "header","type": "string"},'                                                                                                                                                                                                                                                                                                                                                                                                                                               = '';
    '{"name": "Accept","in": "header","type": "string"},'                                                                                                                                                                                                                                                                                                                                                                                                                                                     = '';
    '{"name": "x-org-id","in": "header","type": "string"}'                                                                                                                                                                                                                                                                                                                                                                                                                                                    = '';
    ',,'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      = ',';
    ', ,'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     = ',';
    '{,'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      = '{';
    ',}'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      = '}';
    '[,'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      = '[';
    ',]'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      = ']';
    ', ]'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     = ']';
    "`t"                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      = '\t';
    ',"format": "ipv4"'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       = ''; # Remove StopLight syntax
    # OperationId to Function name mapping - https://github.com/Azure/autorest.powershell/blob/a530bd721c9326a4356fba15638fee236722aca9/powershell/autorest-configuration.md
    # V1 OperationIds for friendlier cmdlet names
    'applications_post'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       = 'Application_Create';
    'applications_delete'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     = 'Application_Delete';
    'applications_get'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        = 'Application_Get';
    'applications_list'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       = 'Application_List';
    'applications_put'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        = 'Application_Put';
    'application_templates_list'                                                                                                                                                                                                                                                                                                                                                                                                                                                                              = 'ApplicationTemplate_List';
    'application_templates_get'                                                                                                                                                                                                                                                                                                                                                                                                                                                                               = 'ApplicationTemplate_Get';
    'commands_post'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           = 'Command_Create';
    'commands_delete'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         = 'Command_Delete';
    'commands_get'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            = 'Command_Get';
    'commands_list'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           = 'Command_List';
    'commands_put'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            = 'Command_Put';
    'command_file_get'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        = 'CommandFile_Get';
    'command_results_delete'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  = 'CommandResult_Delete';
    'command_results_get'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     = 'CommandResult_Get';
    'command_results_list'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    = 'CommandResult_List';
    'command_trigger_webhook_post'                                                                                                                                                                                                                                                                                                                                                                                                                                                                            = 'CommandTriggerWebhook_Start';
    'organization_list'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       = 'Organization_List';
    'search_organizations_post'                                                                                                                                                                                                                                                                                                                                                                                                                                                                               = 'Organization_Search';
    'radius_servers_post'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     = 'RadiusServer_Create';
    'radius_servers_list'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     = 'RadiusServer_List';
    'radius_servers_put'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      = 'RadiusServer_Put';
    'sshkey_post'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             = 'SshKey_Create';
    'sshkey_delete'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           = 'SshKey_Delete';
    'sshkey_list'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             = 'SshKey_List';
    'systems_delete'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          = 'System_Delete';
    'systems_get'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             = 'System_Get';
    'systems_list'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            = 'System_List';
    'systems_put'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             = 'System_Put';
    'search_systems_post'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     = 'System_Search';
    'systems_systemusers_binding_list'                                                                                                                                                                                                                                                                                                                                                                                                                                                                        = 'SystemsSystemUserBinding_List';
    'systems_systemusers_binding_put'                                                                                                                                                                                                                                                                                                                                                                                                                                                                         = 'SystemsSystemUserBinding_Put';
    'systemusers_post'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        = 'SystemUser_Create';
    'systemusers_delete'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      = 'SystemUser_Delete';
    'systemusers_get'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         = 'SystemUser_Get';
    'systemusers_list'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        = 'SystemUser_List';
    'systemusers_put'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         = 'SystemUser_Put';
    'search_systemusers_post'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 = 'SystemUser_Search';
    'systemusers_unlock'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      = 'SystemUser_Unlock';
    'systemusers_resetmfa'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    = 'SystemUserMfa_Reset';
    'systemusers_systems_binding_list'                                                                                                                                                                                                                                                                                                                                                                                                                                                                        = 'SystemUsersSystemBinding_List';
    'systemusers_systems_binding_put'                                                                                                                                                                                                                                                                                                                                                                                                                                                                         = 'SystemUsersSystemBinding_Put';
    'tags_post'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               = 'Tag_Create';
    'tags_delete'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             = 'Tag_Delete';
    'tags_get'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                = 'Tag_Get';
    'tags_list'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               = 'Tag_List';
    'tags_put'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                = 'Tag_Put';
    # V2 OperationIds for friendlier cmdlet names
    'applemdm_post'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           = 'AppleMdm_Create';
    'applemdm_list'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           = 'AppleMdm_List';
    'applemdm_delete'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         = 'AppleMdm_Delete';
    'applemdm_put'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            = 'AppleMdm_Put';
    'policyresults_org_list'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  = 'OrgPolicyResult_List';
    'bulk_usersCreate'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        = 'BulkUsers_Create';
    'bulk_usersCreateResults'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 = 'BulkUsersResult_Get';
    'workdays_deauthorize'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    = 'WorkdayAuthorization_Remove';
    'groups_system_post'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      = 'SystemGroup_Create';
    'groups_user_post'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        = 'UserGroup_Create';
    'groups_system_get'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       = 'SystemGroup_Get';
    'groups_user_get'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         = 'UserGroup_Get';
    'workdays_authorize'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      = 'Workday_Authorize';
    'activedirectories_post'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  = 'ActiveDirectory_Create';
    'activedirectories_agentsPost'                                                                                                                                                                                                                                                                                                                                                                                                                                                                            = 'ActiveDirectoryAgent_Create';
    'duo_accountPost'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         = 'DuoAccount_Create';
    'duo_applicationPost'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     = 'DuoApplication_Create';
    'ldapservers_sambaDomainsPost'                                                                                                                                                                                                                                                                                                                                                                                                                                                                            = 'LdapServerSambaDomain_Create';
    'policies_post'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           = 'Policy_Create';
    'providers_postAdmins'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    = 'ProviderAdmin_Create';
    'translationRules_gSuitePost'                                                                                                                                                                                                                                                                                                                                                                                                                                                                             = 'GSuiteTranslationRule_Create';
    'translationRules_office365Post'                                                                                                                                                                                                                                                                                                                                                                                                                                                                          = 'Office365TranslationRule_Create';
    'workdays_post'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           = 'Workday_Create';
    'activedirectories_agentsDelete'                                                                                                                                                                                                                                                                                                                                                                                                                                                                          = 'ActiveDirectoryAgent_Delete';
    'groups_system_delete'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    = 'SystemGroup_Delete';
    'groups_user_delete'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      = 'UserGroup_Delete';
    'ldapservers_sambaDomainsDelete'                                                                                                                                                                                                                                                                                                                                                                                                                                                                          = 'LdapServerSambaDomain_Delete';
    'translationRules_gSuiteDelete'                                                                                                                                                                                                                                                                                                                                                                                                                                                                           = 'GSuiteTranslationRule_Delete';
    'translationRules_office365Delete'                                                                                                                                                                                                                                                                                                                                                                                                                                                                        = 'Office365TranslationRule_Delete';
    'activedirectories_delete'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                = 'ActiveDirectory_Delete';
    'policies_delete'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         = 'Policy_Delete';
    'activedirectories_agentsGet'                                                                                                                                                                                                                                                                                                                                                                                                                                                                             = 'ActiveDirectoryAgent_Get';
    'gsuites_get'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             = 'GSuite_Get';
    'ldapservers_sambaDomainsGet'                                                                                                                                                                                                                                                                                                                                                                                                                                                                             = 'LdapServerSambaDomain_Get';
    'policytemplates_get'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     = 'PolicyTemplate_Get';
    'systems_getFDEKey'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       = 'SystemFDEKey_Get';
    'translationRules_gSuiteGet'                                                                                                                                                                                                                                                                                                                                                                                                                                                                              = 'GSuiteTranslationRule_Get';
    'translationRules_office365Get'                                                                                                                                                                                                                                                                                                                                                                                                                                                                           = 'Office365TranslationRule_Get';
    'workdays_settings'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       = 'WorkdaySetting_Get';
    'activedirectories_get'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   = 'ActiveDirectory_Get';
    'policies_get'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            = 'Policy_Get';
    'workdays_importresults'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  = 'WorkdayResult_Import';
    'jobs_results'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            = 'JobResult_List';
    'workdays_workers'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        = 'WorkdayWorker_List';
    'activedirectories_agentsList'                                                                                                                                                                                                                                                                                                                                                                                                                                                                            = 'ActiveDirectoryAgent_List';
    'groups_system_list'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      = 'SystemGroup_List';
    'groups_user_list'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        = 'UserGroup_List';
    'ldapservers_sambaDomainsList'                                                                                                                                                                                                                                                                                                                                                                                                                                                                            = 'LdapServerSambaDomain_List';
    'policytemplates_list'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    = 'PolicyTemplate_List';
    'providers_listAdministrators'                                                                                                                                                                                                                                                                                                                                                                                                                                                                            = 'ProviderAdministrator_List';
    'translationRules_gSuiteList'                                                                                                                                                                                                                                                                                                                                                                                                                                                                             = 'GSuiteTranslationRule_List';
    'translationRules_office365List'                                                                                                                                                                                                                                                                                                                                                                                                                                                                          = 'Office365TranslationRule_List';
    'activedirectories_list'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  = 'ActiveDirectory_List';
    'directories_list'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        = 'Directory_List';
    'graph_systemGroupMembersList'                                                                                                                                                                                                                                                                                                                                                                                                                                                                            = 'SystemGroupMembers_List';
    'graph_userGroupMembersList'                                                                                                                                                                                                                                                                                                                                                                                                                                                                              = 'UserGroupMembers_List';
    'policies_list'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           = 'Policy_List';
    'systeminsights_list_apps'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                = 'SystemInsightsApps_List';
    'systeminsights_list_bitlocker_info'                                                                                                                                                                                                                                                                                                                                                                                                                                                                      = 'SystemInsightsBitlockerInfo_List';
    'systeminsights_list_browser_plugins'                                                                                                                                                                                                                                                                                                                                                                                                                                                                     = 'SystemInsightsBrowserPlugins_List';
    'systeminsights_list_chrome_extensions'                                                                                                                                                                                                                                                                                                                                                                                                                                                                   = 'SystemInsightsChromeExtensions_List';
    'systeminsights_list_disk_encryption'                                                                                                                                                                                                                                                                                                                                                                                                                                                                     = 'SystemInsightsDiskEncryption_List';
    'systeminsights_list_disk_info'                                                                                                                                                                                                                                                                                                                                                                                                                                                                           = 'SystemInsightsDiskInfo_List';
    'systeminsights_list_etc_hosts'                                                                                                                                                                                                                                                                                                                                                                                                                                                                           = 'SystemInsightsEtcHosts_List';
    'systeminsights_list_firefox_addons'                                                                                                                                                                                                                                                                                                                                                                                                                                                                      = 'SystemInsightsFirefoxAddons_List';
    'systeminsights_list_groups'                                                                                                                                                                                                                                                                                                                                                                                                                                                                              = 'SystemInsightsGroups_List';
    'systeminsights_list_interface_addresses'                                                                                                                                                                                                                                                                                                                                                                                                                                                                 = 'SystemInsightsInterfaceAddresses_List';
    'systeminsights_list_kernel_info'                                                                                                                                                                                                                                                                                                                                                                                                                                                                         = 'SystemInsightsKernelInfo_List';
    'systeminsights_list_logical_drives'                                                                                                                                                                                                                                                                                                                                                                                                                                                                      = 'SystemInsightsLogicalDrives_List';
    'systeminsights_list_mounts'                                                                                                                                                                                                                                                                                                                                                                                                                                                                              = 'SystemInsightsMounts_List';
    'systeminsights_list_os_version'                                                                                                                                                                                                                                                                                                                                                                                                                                                                          = 'SystemInsightsOsVersion_List';
    'systeminsights_list_patches'                                                                                                                                                                                                                                                                                                                                                                                                                                                                             = 'SystemInsightsPatches_List';
    'systeminsights_list_programs'                                                                                                                                                                                                                                                                                                                                                                                                                                                                            = 'SystemInsightsPrograms_List';
    'systeminsights_list_safari_extensions'                                                                                                                                                                                                                                                                                                                                                                                                                                                                   = 'SystemInsightsSafariExtensions_List';
    'systeminsights_list_system_apps'                                                                                                                                                                                                                                                                                                                                                                                                                                                                         = 'SystemInsightsSystemGroups_List';
    'systeminsights_list_system_bitlocker_info'                                                                                                                                                                                                                                                                                                                                                                                                                                                               = 'SystemInsightsSystemSystemControls_List';
    'systeminsights_list_system_browser_plugins'                                                                                                                                                                                                                                                                                                                                                                                                                                                              = 'SystemInsightsSystemEtcHosts_List';
    'systeminsights_list_system_chrome_extensions'                                                                                                                                                                                                                                                                                                                                                                                                                                                            = 'SystemInsightsSystemApps_List';
    'systeminsights_list_system_controls'                                                                                                                                                                                                                                                                                                                                                                                                                                                                     = 'SystemInsightsSystemControls_List';
    'systeminsights_list_system_disk_encryption'                                                                                                                                                                                                                                                                                                                                                                                                                                                              = 'SystemInsightsSystemInterfaceAddresses_List';
    'systeminsights_list_system_disk_info'                                                                                                                                                                                                                                                                                                                                                                                                                                                                    = 'SystemInsightsSystemUsers_List';
    'systeminsights_list_system_etc_hosts'                                                                                                                                                                                                                                                                                                                                                                                                                                                                    = 'SystemInsightsSystemBitlockerInfo_List';
    'systeminsights_list_system_firefox_addons'                                                                                                                                                                                                                                                                                                                                                                                                                                                               = 'SystemInsightsSystemFirefoxAddons_List';
    'systeminsights_list_system_groups'                                                                                                                                                                                                                                                                                                                                                                                                                                                                       = 'SystemInsightsSystemPatches_List';
    'systeminsights_list_system_info'                                                                                                                                                                                                                                                                                                                                                                                                                                                                         = 'SystemInsightsSystemInfo_List';
    'systeminsights_list_system_interface_addresses'                                                                                                                                                                                                                                                                                                                                                                                                                                                          = 'SystemInsightsSystemMounts_List';
    'systeminsights_list_system_kernel_info'                                                                                                                                                                                                                                                                                                                                                                                                                                                                  = 'SystemInsightsSystemOsVersion_List';
    'systeminsights_list_system_logical_drives'                                                                                                                                                                                                                                                                                                                                                                                                                                                               = 'SystemInsightsSystemDiskEncryption_List';
    'systeminsights_list_system_mounts'                                                                                                                                                                                                                                                                                                                                                                                                                                                                       = 'SystemInsightsSystemChromeExtensions_List';
    'systeminsights_list_system_os_version'                                                                                                                                                                                                                                                                                                                                                                                                                                                                   = 'SystemInsightsSystemLogicalDrives_List';
    'systeminsights_list_system_patches'                                                                                                                                                                                                                                                                                                                                                                                                                                                                      = 'SystemInsightsSystemDiskInfo_List';
    'systeminsights_list_system_programs'                                                                                                                                                                                                                                                                                                                                                                                                                                                                     = 'SystemInsightsSystemKernelInfo_List';
    'systeminsights_list_system_safari_extensions'                                                                                                                                                                                                                                                                                                                                                                                                                                                            = 'SystemInsightsSystemBrowserPlugins_List';
    'systeminsights_list_system_system_controls'                                                                                                                                                                                                                                                                                                                                                                                                                                                              = 'SystemInsightsSystemSystemInfo_List';
    'systeminsights_list_system_system_info'                                                                                                                                                                                                                                                                                                                                                                                                                                                                  = 'SystemInsightsSystemSafariExtensions_List';
    'systeminsights_list_system_uptime'                                                                                                                                                                                                                                                                                                                                                                                                                                                                       = 'SystemInsightsSystemUptime_List';
    'systeminsights_list_system_users'                                                                                                                                                                                                                                                                                                                                                                                                                                                                        = 'SystemInsightsSystemPrograms_List';
    'systeminsights_list_uptime'                                                                                                                                                                                                                                                                                                                                                                                                                                                                              = 'SystemInsightsUptime_List';
    'systeminsights_list_users'                                                                                                                                                                                                                                                                                                                                                                                                                                                                               = 'SystemInsightsUsers_List';
    'groups_system_patch'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     = 'SystemGroup_Patch';
    'groups_user_patch'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       = 'UserGroup_Patch';
    'gsuites_patch'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           = 'GSuite_Patch';
    'groups_system_put'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       = 'SystemGroup_Put';
    'groups_user_put'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         = 'UserGroup_Put';
    'ldapservers_sambaDomainsPut'                                                                                                                                                                                                                                                                                                                                                                                                                                                                             = 'LdapServerSambaDomain_Put';
    'policies_put'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            = 'Policy_Put';
    'users_sendEmails'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        = 'UserEmail_Send';
    'graph_activeDirectoryAssociationsPost'                                                                                                                                                                                                                                                                                                                                                                                                                                                                   = 'ActiveDirectoryAssociation_Set';
    'graph_applicationAssociationsPost'                                                                                                                                                                                                                                                                                                                                                                                                                                                                       = 'ApplicationAssociation_Set';
    'graph_commandAssociationsPost'                                                                                                                                                                                                                                                                                                                                                                                                                                                                           = 'CommandAssociation_Set';
    'graph_gSuiteAssociationsPost'                                                                                                                                                                                                                                                                                                                                                                                                                                                                            = 'GSuiteAssociation_Set';
    'graph_ldapServerAssociationsPost'                                                                                                                                                                                                                                                                                                                                                                                                                                                                        = 'LdapServerAssociation_Set';
    'graph_office365AssociationsPost'                                                                                                                                                                                                                                                                                                                                                                                                                                                                         = 'Office365Association_Set';
    'graph_policyAssociationsPost'                                                                                                                                                                                                                                                                                                                                                                                                                                                                            = 'PolicyAssociation_Set';
    'graph_radiusServerAssociationsPost'                                                                                                                                                                                                                                                                                                                                                                                                                                                                      = 'RadiusServerAssociation_Set';
    'graph_systemAssociationsPost'                                                                                                                                                                                                                                                                                                                                                                                                                                                                            = 'SystemAssociation_Set';
    'graph_systemGroupAssociationsPost'                                                                                                                                                                                                                                                                                                                                                                                                                                                                       = 'SystemGroupAssociation_Set';
    'graph_systemGroupMembersPost'                                                                                                                                                                                                                                                                                                                                                                                                                                                                            = 'SystemGroupMembers_Set';
    'graph_userAssociationsPost'                                                                                                                                                                                                                                                                                                                                                                                                                                                                              = 'UserAssociation_Set';
    'graph_userGroupAssociationsPost'                                                                                                                                                                                                                                                                                                                                                                                                                                                                         = 'UserGroupAssociation_Set';
    'graph_userGroupMembersPost'                                                                                                                                                                                                                                                                                                                                                                                                                                                                              = 'UserGroupMembers_Set';
    'bulk_usersUpdate'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        = 'BulkUsers_Update';
    'workdays_delete'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         = 'Workday_Delete';
    'duo_accountDelete'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       = 'DuoAccount_Delete';
    'duo_applicationDelete'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   = 'DuoApplication_Delete';
    'jobs_get'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                = 'Job_Get';
    'ldapservers_get'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         = 'LdapServer_Get';
    'policyresults_get'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       = 'PolicyResult_Get';
    'workdays_get'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            = 'Workday_Get';
    'duo_accountGet'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          = 'DuoAccount_Get';
    'duo_applicationGet'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      = 'DuoApplication_Get';
    'org_crypto_get'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          = 'OrgCrypto_Get';
    'workdays_import'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         = 'Workday_Import';
    'graph_activeDirectoryTraverseUser'                                                                                                                                                                                                                                                                                                                                                                                                                                                                       = 'ActiveDirectoryTraverseUser_List';
    'graph_activeDirectoryTraverseUserGroup'                                                                                                                                                                                                                                                                                                                                                                                                                                                                  = 'ActiveDirectoryTraverseUserGroup_List';
    'graph_applicationTraverseUser'                                                                                                                                                                                                                                                                                                                                                                                                                                                                           = 'ApplicationTraverseUser_List';
    'graph_applicationTraverseUserGroup'                                                                                                                                                                                                                                                                                                                                                                                                                                                                      = 'ApplicationTraverseUserGroup_List';
    'graph_commandTraverseSystem'                                                                                                                                                                                                                                                                                                                                                                                                                                                                             = 'CommandTraverseSystem_List';
    'graph_commandTraverseSystemGroup'                                                                                                                                                                                                                                                                                                                                                                                                                                                                        = 'CommandTraverseSystemGroup_List';
    'graph_gSuiteTraverseUser'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                = 'GSuiteTraverseUser_List';
    'graph_gSuiteTraverseUserGroup'                                                                                                                                                                                                                                                                                                                                                                                                                                                                           = 'GSuiteTraverseUserGroup_List';
    'graph_ldapServerTraverseUser'                                                                                                                                                                                                                                                                                                                                                                                                                                                                            = 'LdapServerTraverseUser_List';
    'graph_ldapServerTraverseUserGroup'                                                                                                                                                                                                                                                                                                                                                                                                                                                                       = 'LdapServerTraverseUserGroup_List';
    'graph_office365TraverseUser'                                                                                                                                                                                                                                                                                                                                                                                                                                                                             = 'Office365TraverseUser_List';
    'graph_office365TraverseUserGroup'                                                                                                                                                                                                                                                                                                                                                                                                                                                                        = 'Office365TraverseUserGroup_List';
    'graph_policyTraverseSystem'                                                                                                                                                                                                                                                                                                                                                                                                                                                                              = 'PolicyTraverseSystem_List';
    'graph_policyTraverseSystemGroup'                                                                                                                                                                                                                                                                                                                                                                                                                                                                         = 'PolicyTraverseSystemGroup_List';
    'graph_radiusServerTraverseUser'                                                                                                                                                                                                                                                                                                                                                                                                                                                                          = 'RadiusServerTraverseUser_List';
    'graph_radiusServerTraverseUserGroup'                                                                                                                                                                                                                                                                                                                                                                                                                                                                     = 'RadiusServerTraverseUserGroup_List';
    'graph_systemGroupMemberOf'                                                                                                                                                                                                                                                                                                                                                                                                                                                                               = 'SystemGroupMemberOf_List';
    'graph_systemGroupMembership'                                                                                                                                                                                                                                                                                                                                                                                                                                                                             = 'SystemGroupMembership_List';
    'graph_systemGroupTraverseCommand'                                                                                                                                                                                                                                                                                                                                                                                                                                                                        = 'SystemGroupTraverseCommand_List';
    'graph_systemGroupTraversePolicy'                                                                                                                                                                                                                                                                                                                                                                                                                                                                         = 'SystemGroupTraversePolicy_List';
    'graph_systemGroupTraverseUser'                                                                                                                                                                                                                                                                                                                                                                                                                                                                           = 'SystemGroupTraverseUser_List';
    'graph_systemGroupTraverseUserGroup'                                                                                                                                                                                                                                                                                                                                                                                                                                                                      = 'SystemGroupTraverseUserGroup_List';
    'graph_systemMemberOf'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    = 'SystemMemberOf_List';
    'graph_systemTraverseCommand'                                                                                                                                                                                                                                                                                                                                                                                                                                                                             = 'SystemTraverseCommand_List';
    'graph_systemTraversePolicy'                                                                                                                                                                                                                                                                                                                                                                                                                                                                              = 'SystemTraversePolicy_List';
    'graph_systemTraverseUser'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                = 'SystemTraverseUser_List';
    'graph_systemTraverseUserGroup'                                                                                                                                                                                                                                                                                                                                                                                                                                                                           = 'SystemTraverseUserGroup_List';
    'graph_userGroupMemberOf'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 = 'UserGroupMemberOf_List';
    'graph_userGroupMembership'                                                                                                                                                                                                                                                                                                                                                                                                                                                                               = 'UserGroupMembership_List';
    'graph_userGroupTraverseActiveDirectory'                                                                                                                                                                                                                                                                                                                                                                                                                                                                  = 'UserGroupTraverseActiveDirectory_List';
    'graph_userGroupTraverseApplication'                                                                                                                                                                                                                                                                                                                                                                                                                                                                      = 'UserGroupTraverseApplication_List';
    'graph_userGroupTraverseDirectory'                                                                                                                                                                                                                                                                                                                                                                                                                                                                        = 'UserGroupTraverseDirectory_List';
    'graph_userGroupTraverseGSuite'                                                                                                                                                                                                                                                                                                                                                                                                                                                                           = 'UserGroupTraverseGSuite_List';
    'graph_userGroupTraverseLdapServer'                                                                                                                                                                                                                                                                                                                                                                                                                                                                       = 'UserGroupTraverseLdapServer_List';
    'graph_userGroupTraverseOffice365'                                                                                                                                                                                                                                                                                                                                                                                                                                                                        = 'UserGroupTraverseOffice365_List';
    'graph_userGroupTraverseRadiusServer'                                                                                                                                                                                                                                                                                                                                                                                                                                                                     = 'UserGroupTraverseRadiusServer_List';
    'graph_userGroupTraverseSystem'                                                                                                                                                                                                                                                                                                                                                                                                                                                                           = 'UserGroupTraverseSystem_List';
    'graph_userGroupTraverseSystemGroup'                                                                                                                                                                                                                                                                                                                                                                                                                                                                      = 'UserGroupTraverseSystemGroup_List';
    'graph_userMemberOf'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      = 'UserMemberOf_List';
    'graph_userTraverseActiveDirectory'                                                                                                                                                                                                                                                                                                                                                                                                                                                                       = 'UserTraverseActiveDirectory_List';
    'graph_userTraverseApplication'                                                                                                                                                                                                                                                                                                                                                                                                                                                                           = 'UserTraverseApplication_List';
    'graph_userTraverseDirectory'                                                                                                                                                                                                                                                                                                                                                                                                                                                                             = 'UserTraverseDirectory_List';
    'graph_userTraverseGSuite'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                = 'UserTraverseGSuite_List';
    'graph_userTraverseLdapServer'                                                                                                                                                                                                                                                                                                                                                                                                                                                                            = 'UserTraverseLdapServer_List';
    'graph_userTraverseOffice365'                                                                                                                                                                                                                                                                                                                                                                                                                                                                             = 'UserTraverseOffice365_List';
    'graph_userTraverseRadiusServer'                                                                                                                                                                                                                                                                                                                                                                                                                                                                          = 'UserTraverseRadiusServer_List';
    'graph_userTraverseSystem'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                = 'UserTraverseSystem_List';
    'graph_userTraverseSystemGroup'                                                                                                                                                                                                                                                                                                                                                                                                                                                                           = 'UserTraverseSystemGroup_List';
    'graph_activeDirectoryAssociationsList'                                                                                                                                                                                                                                                                                                                                                                                                                                                                   = 'ActiveDirectoryAssociation_List';
    'graph_applicationAssociationsList'                                                                                                                                                                                                                                                                                                                                                                                                                                                                       = 'ApplicationAssociation_List';
    'graph_commandAssociationsList'                                                                                                                                                                                                                                                                                                                                                                                                                                                                           = 'CommandAssociation_List';
    'graph_gSuiteAssociationsList'                                                                                                                                                                                                                                                                                                                                                                                                                                                                            = 'GSuiteAssociation_List';
    'graph_ldapServerAssociationsList'                                                                                                                                                                                                                                                                                                                                                                                                                                                                        = 'LdapServerAssociation_List';
    'graph_office365AssociationsList'                                                                                                                                                                                                                                                                                                                                                                                                                                                                         = 'Office365Association_List';
    'graph_policyAssociationsList'                                                                                                                                                                                                                                                                                                                                                                                                                                                                            = 'PolicyAssociation_List';
    'graph_radiusServerAssociationsList'                                                                                                                                                                                                                                                                                                                                                                                                                                                                      = 'RadiusServerAssociation_List';
    'graph_systemAssociationsList'                                                                                                                                                                                                                                                                                                                                                                                                                                                                            = 'SystemAssociation_List';
    'graph_systemGroupAssociationsList'                                                                                                                                                                                                                                                                                                                                                                                                                                                                       = 'SystemGroupAssociation_List';
    'graph_userAssociationsList'                                                                                                                                                                                                                                                                                                                                                                                                                                                                              = 'UserAssociation_List';
    'graph_userGroupAssociationsList'                                                                                                                                                                                                                                                                                                                                                                                                                                                                         = 'UserGroupAssociation_List';
    'groups_list'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             = 'Group_List';
    'ldapservers_list'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        = 'LdapServer_List';
    'policyresults_list'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      = 'PolicyResult_List';
    'policystatuses_list'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     = 'PolicyStatus_List';
    'workdays_list'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           = 'Workday_List';
    'duo_accountList'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         = 'DuoAccount_List';
    'duo_applicationList'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     = 'DuoApplication_List';
    'ldapservers_patch'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       = 'LdapServer_Patch';
    'workdays_put'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            = 'Workday_Put';
    'org_crypto_put'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          = 'OrgCrypto_Put';
    'duo_applicationUpdate'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   = 'DuoApplication_Update';

}
$ApiHash.GetEnumerator() | ForEach-Object {
    If ($_.Name.Replace('Url_', '') -in $APIName)
    {
        $OutputFileName = ($_.Name).Split('_')[1] + '.json'
        $OutputFullPath = $OutputFilePath + $OutputFileName
        If (-not (Test-Path -Path:($OutputFilePath)))
        {
            New-Item -Path:($OutputFilePath) -ItemType:('Directory')
        }
        $WebRequest = If ($_.Name -like 'Url_*')
        {
            (Invoke-WebRequest -Uri:($_.Value)).Content
        }
        Else
        {
            Get-Content -Path:($_.Value) -Raw
        }
        If ([System.String]::IsNullOrEmpty($WebRequest))
        {
            Write-Error ('No content was returned from: ' + $_.Value)
        }
        Else
        {
            # Prep json for find and replace by flattening string
            $ReadyForConvert = If ($_.Value -like '*.yaml*')
            {
                $WebRequest | ConvertFrom-Yaml -Ordered | ConvertTo-Yaml -JsonCompatible
            }
            Else
            {
                $WebRequest
            }
            # Manipulate JSON
            $OperationIdMatches = Select-String -InputObject:($ReadyForConvert) -Pattern:([regex]'(?s)(?<=operationId": ")(.*?)(?=".*?$)') -AllMatches
            $OperationIdMatchesValues = $OperationIdMatches.Matches.Value
            ForEach ($OperationIdMatchesValue In $OperationIdMatchesValues)
            {
                If (-not $FindReplaceHash.Contains([System.String]$OperationIdMatchesValue))
                {
                    Write-Warning ('Unknown ' + $_.Name + ' operationId: ' + $OperationIdMatchesValue + ';')
                }
            }
            While ($ReadyForConvert -match "`n ")
            {
                $ReadyForConvert = $ReadyForConvert.Replace("`n ", "`n")
            }
            $ReadyForConvert = $ReadyForConvert.Replace("`n", "")
            While ($ReadyForConvert -match "`r ")
            {
                $ReadyForConvert = $ReadyForConvert.Replace("`r ", "`r")
            }
            $ReadyForConvert = $ReadyForConvert.Replace("`r", "")
            # Transform file
            $FindReplaceHash.GetEnumerator() | ForEach-Object {
                $PatternMatch = $ReadyForConvert | Select-String -Pattern:([regex]::Escape($_.Name))
                If (-not [System.String]::IsNullOrEmpty($PatternMatch))
                {
                    $ReadyForConvert = $ReadyForConvert.Replace([string]$_.Name, [string]$_.Value)
                    $ReadyForConvert = $ReadyForConvert.Replace([string]$PatternMatch.Matches.Value, [string]$_.Value)
                }
            }
            # Convert json string to object
            # $ReadyForConvert | Out-File -FilePath:($OutputFilePath + ($_.Name).Split('_')[1] + '_ReadyForConvert.json')
            $JsonExport = $ReadyForConvert | ConvertFrom-Json -Depth:(99);
            # Remove tag elements
            $JsonExport.paths = $JsonExport.paths | Select-Object * -ExcludeProperty:('/tags', '/Tag/{name}', '/Tags/{name}');
            # Remove "public": false elements
            $PathNames = ($JsonExport.paths | Get-Member -MemberType NoteProperty | ForEach-Object { $_.Name } )
            ForEach ($PathName In $PathNames)
            {
                $PathChildNames = ($JsonExport.paths.$PathName | Get-Member -MemberType NoteProperty | ForEach-Object { $_.Name } )
                ForEach ($PathChildName In $PathChildNames)
                {
                    If ($JsonExport.paths.$PathName.$PathChildName.'x-stoplight'.public -eq $false)
                    {
                        Write-Warning ('Excluding "Path" "' + $PathName + '" "' + $PathChildName + '"')
                        $JsonExport.paths = $JsonExport.paths | Select-Object * -ExcludeProperty:($PathName)
                    }
                }
            }
            $DefinitionNames = ($JsonExport.definitions | Get-Member -MemberType NoteProperty | ForEach-Object { $_.Name } )
            ForEach ($DefinitionName In $DefinitionNames)
            {
                If ($JsonExport.definitions.$DefinitionName.$DefinitionChildName.'x-stoplight'.public -eq $false)
                {
                    Write-Warning ('Excluding "Definition" "' + $DefinitionName + '"')
                    $JsonExport.definitions = $JsonExport.definitions | Select-Object * -ExcludeProperty:($DefinitionName)
                }
            }
            $TextSectionNames = ($JsonExport.'x-stoplight'.TextSections | Get-Member -MemberType NoteProperty | ForEach-Object { $_.Name } )
            ForEach ($TextSectionName In $TextSectionNames)
            {
                $TextSectionChildNames = ($JsonExport.'x-stoplight'.TextSections.$TextSectionName | Get-Member -MemberType NoteProperty | ForEach-Object { $_.Name } )
                ForEach ($TextSectionChildName In $TextSectionChildNames)
                {
                    If ($JsonExport.'x-stoplight'.TextSections.$TextSectionName.$TextSectionChildName.'x-stoplight'.public -eq $false)
                    {
                        Write-Warning ('Excluding "TextSection" "' + $TextSectionName + '"')
                        $JsonExport.'x-stoplight'.TextSections = $JsonExport.'x-stoplight'.TextSections | Select-Object * -ExcludeProperty:($TextSectionName)
                    }
                }
            }
            # $PathHash = [ordered]@{ }
            # $PathNames | ForEach-Object {
            #     $PathName = $_
            #     $MethodHash = [ordered]@{ }
            #     $MethodNames = ($JsonExport.paths.$PathName | Get-Member -MemberType NoteProperty | ForEach-Object { $_.Name }) # | Sort-Object)
            #     $MethodNames | ForEach-Object {
            #         $MethodName = $_
            #         $IsPublic = $PathName.$MethodName.x-stoplight.public
            #         If ($IsPublic -eq 'true')
            #         {
            #             $Method = $JsonExport.paths.$PathName.$MethodName
            #             $MethodHash.Add($MethodName, $Method)
            #         }
            #     }
            #     $JsonExport.paths.$PathName = $MethodHash
            #     $PathHash.Add($PathName, $JsonExport.paths.$PathName)
            # }
            # $JsonExport.paths = $PathHash

            # $parametersHash = [ordered]@{ }
            # $parameterNames = ($JsonExport.parameters | Get-Member -MemberType NoteProperty | ForEach-Object { $_.Name } | Sort-Object)
            # $parametersHash = [ordered]@{ }
            # $parameterNames | ForEach-Object {
            #     $parameterName = $_
            #     $parametersHash.Add($parameterName, $JsonExport.parameters.$parameterName)
            # }
            # $JsonExport.parameters = $parametersHash


            # $definitionsHash = [ordered]@{ }
            # $definitionsNames = ($JsonExport.definitions | Get-Member -MemberType NoteProperty | ForEach-Object { $_.Name } | Sort-Object)
            # $definitionsHash = [ordered]@{ }
            # $definitionsNames | ForEach-Object {
            #     $definitionsName = $_
            #     $definitionsHash.Add($definitionsName, $JsonExport.definitions.$definitionsName)
            # }
            # $JsonExport.definitions = $definitionsHash

            # Export file
            # $WebRequest | Out-File -FilePath:($OutputFilePath + ($_.Name).Split('_')[1] + '_Org.json')
            $NewSpec = $JsonExport | ConvertTo-Json -Depth:(99)
            If (Test-Path -Path:($OutputFullPath))
            {
                $CurrentSpec = Get-Content -Path:($OutputFullPath) -Raw
                $CurrentSpecCompare = [System.String]$CurrentSpec.Trim() -split "`r"
                $NewSpecCompare = [System.String]$NewSpec.Trim() -split "`r"
                $CompareResults = Compare-Object -ReferenceObject:($CurrentSpecCompare) -DifferenceObject:($NewSpecCompare)
                If (-not [System.String]::IsNullOrEmpty($CompareResults))
                {
                    $UpdatedSpec = $true
                    $NewSpec | Out-File -FilePath:($OutputFullPath)
                    # If ($env:USERNAME -eq 'VssAdministrator')
                    # {
                    #     Try
                    #     {
                    #         Invoke-Git -Arguments:('config user.email "' + $env:BUILD_REQUESTEDFOREMAIL + '";')
                    #         Invoke-Git -Arguments:('config user.name "' + $env:BUILD_REQUESTEDFOR + '";')
                    #         Invoke-Git -Arguments:('add -A')
                    #         Invoke-Git -Arguments:('status')
                    #         Invoke-Git -Arguments:('commit -m ' + '"Updating OAS spec: ' + $OutputFileName + ';[skip ci]";')
                    #         Invoke-Git -Arguments:('push origin HEAD:refs/heads/' + $env:BUILD_SOURCEBRANCHNAME + ';')
                    #     }
                    #     Catch
                    #     {
                    #         Write-Error $_
                    #     }
                    # }
                }
            }
            Else
            {
                $UpdatedSpec = $true
                $NewSpec | Out-File -FilePath:($OutputFullPath)
            }
        }
    }
}
Write-Host ("##vso[task.setvariable variable=UpdatedSpec]$UpdatedSpec")
Return $UpdatedSpec

# Invoke-Git [[-Arguments] <Object>] [-NoWindow <Object>] [-RedirectStandardError <Object>] [-RedirectStandardOutput  <Object>] [-UseShellExecute <Object>] [-Path <Object>] [-Quiet <Object>] [-Split <Object>] [-Raw <Object>] [-GitPath <String>] [<CommonParameters>]
# Publish-GithubRelease [-AccessToken] <String> [-RepositoryOwner] <String> [[-RepositoryName] <String>] [-TagName]    <String> [[-TargetCommit] <String>] [[-Name] <String>] [[-ReleaseText] <String>] [-Draft] [-PreRelease] [[-Artifact] <String[]>] [<CommonParameters>]
# Get-GitChangedFile [[-Path] <Object>] [[-Commit] <Object>] [[-Include] <String[]>] [[-Exclude] <String[]>] [-Resolve] [<CommonParameters>]

# Get-GitChangedFile -Path:('C:\Users\epanipinto\Documents\GitHub\jcapi-powershell')
